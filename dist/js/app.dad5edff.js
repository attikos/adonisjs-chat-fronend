!function(e){function t(t){for(var n,o,i=t[0],c=t[1],u=t[2],l=0,f=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&f.push(s[o][0]),s[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(p&&p(t);f.length;)f.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,i=1;i<r.length;i++){var c=r[i];0!==s[c]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},s={app:0},a=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var p=c;a.push([0,"chunk-vendors"]),r()}({0:function(e,t,r){e.exports=r("56d7")},"1a42":function(e,t){e.exports={API_URL:"https://mighty-savannah-90439.herokuapp.com",API_URL_WEBSOCKET:"wss://mighty-savannah-90439.herokuapp.com"}},"243d":function(e,t,r){},3298:function(e,t,r){"use strict";r("243d")},"56d7":function(e,t,r){"use strict";r.r(t),r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),s=(r("8e6e"),r("ac6a"),r("456d"),r("96cf"),r("3b8d")),a=r("bd86"),o=r("3ce5"),i=(r("c561"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auth"},[r("div",{staticClass:"auth__header-wrapper header-container"},[r("div",{staticClass:"header-title"},[r("p",{staticClass:"auth__header-text header-title-text"},[e._v("Auth")]),r("div",{staticClass:"auth__tabs"},[r("button",{staticClass:"auth__tab",class:{active:"login"===e.activeTab},on:{click:function(t){e.activeTab="login"}}},[e._v(" Login ")]),r("button",{staticClass:"auth__tab",class:{active:"register"===e.activeTab},on:{click:function(t){e.activeTab="register"}}},[e._v(" Register ")])])])]),"login"===e.activeTab?r("div",[r("h2",[e._v("Login")]),r("form",{staticClass:"auth__form",on:{submit:function(t){return t.preventDefault(),e.onLogin(t)}}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"input auth__input",attrs:{type:"email",name:"email",placeholder:"Email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),r("span",{staticClass:"input-animation"}),r("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input auth__input",attrs:{type:"password",name:"password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),r("span",{staticClass:"input-animation"}),e.error?r("p",{staticClass:"auth__error"},[e._v(e._s(e.error))]):e._e(),r("button",{staticClass:"auth__btn-submit btn-submit",attrs:{type:"submit"}},[e._v("Submit")])])]):e._e(),"register"===e.activeTab?r("div",[r("h2",[e._v("Register")]),r("form",{staticClass:"auth__form",on:{submit:function(t){return t.preventDefault(),e.onRegister(t)}}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"input auth__input",attrs:{type:"email",name:"email",placeholder:"Email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),r("span",{staticClass:"input-animation"}),r("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input auth__input",attrs:{type:"password",name:"password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),r("span",{staticClass:"input-animation"}),r("input",{directives:[{name:"model",rawName:"v-model",value:e.passwordConfirm,expression:"passwordConfirm"}],staticClass:"input auth__input",attrs:{type:"password",name:"confirm_password",placeholder:"Confirm password"},domProps:{value:e.passwordConfirm},on:{input:function(t){t.target.composing||(e.passwordConfirm=t.target.value)}}}),r("span",{staticClass:"input-animation"}),e.error?r("p",{staticClass:"auth__error"},[e._v(e._s(e.error))]):e._e(),r("button",{staticClass:"auth__btn-submit btn-submit",attrs:{type:"submit"}},[e._v("Submit")])])]):e._e(),e._m(0)])}),c=r("2f62");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={name:"auth",data:function(){return{email:"test@domain.tld",password:"1234",passwordConfirm:"",activeTab:"login"}},computed:p(p({},Object(c.e)(["error"])),Object(c.c)(["isAuth"])),watch:{activeTab:function(){this.setError("")}},created:function(){this.checkAuth()},methods:p(p(p({},Object(c.d)(["setUser","setError"])),Object(c.b)(["checkAuth","login","register"])),{},{onLogin:function(){this.login({email:this.email,password:this.password})},onRegister:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.register({email:this.email,password:this.password,passwordConfirm:this.passwordConfirm});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()})},f=(r("3298"),r("2877")),m=Object(f.a)(l,i,[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auth__bg"},[r("span",{staticClass:"auth__bg-left"},[e._v("⊕")]),r("span",{staticClass:"auth__bg-right"},[e._v("⊕")])])}],!1,null,null,null).exports,d=(r("7f7f"),r("4f7f"),r("5df3"),r("1c4c"),r("75fc")),h=(r("20d6"),r("bc3a")),b=r.n(h).a.create(),g=r("1a42");b.defaults.baseURL=g.API_URL,b.defaults.withCredentials=!0;var v=b,w=function(e){k!==e&&(k=e,window.localStorage.setItem("token",e)),b.defaults.headers.common={Authorization:"bearer ".concat(e)}},k=window.localStorage.getItem("token");k&&w(k);var _=r("1ba4"),y=r.n(_),O=r("1a42"),C={callbackList:{},connect:function(){var e=this;return new Promise(function(){var t=Object(s.a)(regeneratorRuntime.mark((function t(r,n){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=k,t.t0=e.socket,t.t0){t.next=7;break}return t.next=6,y()(O.API_URL_WEBSOCKET).withApiToken(a).connect();case 6:t.t0=t.sent;case 7:e.socket=t.t0,e.socket.on("close",(function(){console.log("close"),e.runCallback("close")})),e.socket.on("open",Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("connected"),e.runCallback("open"),t.next=4,e.subscribe();case 4:r();case 5:case"end":return t.stop()}}),t)})))),e.socket.on("error",(function(){e.runCallback("error"),n(),console.log("disconnected")})),window.socket=e,t.next=17;break;case 14:t.prev=14,t.t1=t.catch(0),console.log(t.t1);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e,r){return t.apply(this,arguments)}}())},close:function(){this.socket&&this.socket.close(),this.subscription&&this.subscription.close(),this.socket=void 0,this.subscription=void 0},subscribe:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.socket){e.next=2;break}throw new Error("Websocket not connected. Subscription not available.");case 2:if(e.prev=2,e.t0=t.subscription,e.t0){e.next=8;break}return e.next=7,t.socket.subscribe("chat");case 7:e.t0=e.sent;case 8:t.subscription=e.t0,e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),console.log(e.t1);case 14:t.subscription.on("ready",(function(){console.log("ready"),r()})),t.subscription.on("error",(function(e){console.log("error",e),n()}));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),on:function(e,t){this.socket&&this.setCallback(e,t)},off:function(e){this.socket&&this.setCallback(e)},runCallback:function(e){console.log("run",e),this.callbackList[e]&&this.callbackList[e].call()},setCallback:function(e,t){t?(this.callbackList[e]=t,"open"===e&&this.socket&&this.runCallback("open")):delete this.callbackList[e]}},x={getList:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.post("/list");case 3:r=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{});case 10:return e.abrupt("return",(null===(t=r)||void 0===t?void 0:t.data)||{});case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),checkAuth:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.post("/check");case 3:r=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{});case 10:return e.abrupt("return",(null===(t=r)||void 0===t?void 0:t.data)||{});case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),login:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r,n,s,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,e.prev=1,e.next=4,v.post("/login",{email:r,password:n});case 4:a=e.sent,s=(null==a?void 0:a.data)||{},i=(o=s).success,c=o.user,i&&c.token&&w(c.token),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",{});case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),register:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r,n,s,a,o,i,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,s=t.passwordConfirm,e.prev=1,e.next=4,v.post("/register",{email:r,password:n,passwordConfirm:s});case 4:o=e.sent,a=(null==o?void 0:o.data)||{},c=(i=a).success,u=i.user,i.errorMessage,c&&u.token&&w(u.token),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",{});case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),logout:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.post("/logout");case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 9:C.close(),delete b.defaults.headers.common.Authorization,window.localStorage.removeItem("token");case 11:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}()};n.default.use(c.a);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var P={name:"app",components:{Chat:o.Chat,Auth:m},data:function(){return{isConnected:!1,placeholder:"send your message",colors:{header:{bg:"#086CA2",text:"#fff"},message:{myself:{bg:"#fff",text:"#555"},others:{bg:"#dfefff",text:"#555"},messagesDisplay:{bg:"#f7f3f3"}},submitIcon:"#086CA2",submitImageIcon:"#086CA2"},borderStyle:{topLeft:"10px",topRight:"10px",bottomLeft:"10px",bottomRight:"10px"},submitIconSize:24,closeButtonIconSize:"20px",asyncMode:!0,scrollBottom:{messageSent:!0,messageReceived:!1},profilePictureConfig:{others:!1,myself:!1,styles:{width:"30px",height:"30px",borderRadius:"50%"}},timestampConfig:{format:"HH:mm",relative:!1},linkOptions:{myself:{className:"myLinkClass",events:{click:function(e){console.log("Link clicked!")},mouseover:function(e){console.log("Link hovered!")}},format:function(e,t){return"url"===t&&e.length>50&&(e=e.slice(0,50)+"…"),e}},others:{className:"othersLinkClass",events:{click:function(e){e.preventDefault(),console.log("Link clicked!")},mouseover:function(e){console.log("Link hovered!")}},format:function(e,t){return"url"===t&&e.length>50&&(e=e.slice(0,50)+"…"),e}}}}},computed:R(R(R({},Object(c.e)(["user"])),Object(c.c)(["isAuth","messages","participants"])),{},{chatTitle:function(){return"Chat of the doom"}}),watch:{isAuth:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return e.next=3,this.fetchMessages();case 3:return e.next=5,C.connect();case 5:this.addSocketListeners(),this.messages.length&&(r=this.messages.filter((function(e){return e.participantId!==n.user.id&&!e.viewed})).map((function(e){return e.id})),this.sendMarkMessageAsViewed(r));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},beforeCreate:function(){this.$store=new c.a.Store({strict:!1,state:{user:!1,messagesRaw:[],participantsRaw:[],error:""},mutations:{setError:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.error=t},setUser:function(e,t){e.user=t},addMessage:function(e,t){e.messagesRaw.push(t)},setAsViewed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Array.isArray(t)?t.forEach((function(t){var r=e.messagesRaw.findIndex((function(e){return e.id===t})),n=e.messagesRaw[r];-1!==r&&(n.viewed=!0,e.messagesRaw.splice(r,1,n))})):console.error("messageIdList is not ARRAY!!!",t)},setMessageList:function(e,t){e.messagesRaw=Object(d.a)(t)},setParticipant:function(e,t){var r=Object(d.a)(e.participantsRaw);r.push(t),e.participantsRaw=Array.from(new Set(r))},setParticipantList:function(e,t){e.participantsRaw=Object(d.a)(t)}},getters:{isAuth:function(e){return Boolean(null==e?void 0:e.user.id)},participants:function(e){var t=null==e?void 0:e.user.name;return e.participantsRaw.filter((function(e){return e.name!==t}))},messages:function(e){return Object(d.a)(e.messagesRaw).map((function(e){return e.timestamp=e.created_at,e.participantId=e.user_id||e.participantId,delete e.user_id,e}))}},actions:{fetchMessages:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r,n,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commit,e.next=3,x.getList();case 3:n=e.sent,s=n.messages,a=n.participants,s&&a&&(r("setMessageList",s),r("setParticipantList",a));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),logout:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commit,e.next=3,x.logout();case 3:r("setUser",{});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),checkAuth:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){var r,n,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.commit,e.next=3,x.checkAuth();case 3:n=e.sent,s=n.success,a=n.user,s&&r("setUser",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t,r){var n,s,a,o,i,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.commit,s=r.email,a=r.password,n("setError",""),e.next=5,x.login({email:s,password:a});case 5:o=e.sent,i=o.success,c=o.user,u=o.errorMessage,i&&c.token?n("setUser",c):u&&n("setError",u);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),register:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t,r){var n,s,a,o,i,c,u,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.commit,s=r.email,a=r.password,o=r.passwordConfirm,n("setError",""),e.next=5,x.register({email:s,password:a,passwordConfirm:o});case 5:i=e.sent,c=i.success,u=i.user,p=i.errorMessage,c&&u.token?n("setUser",u):p&&n("setError",p);case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}})},beforeDestroy:function(){C.close()},methods:R(R(R({},Object(c.b)(["fetchMessages","logout"])),Object(c.d)(["setUser","addMessage","setAsViewed","setParticipant","setParticipantList"])),{},{sendMarkMessageAsViewed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];C.subscription.emit("viewed",e)},addSocketListeners:function(){var e=this;C.on("close",(function(){e.isConnected=!1,console.log("close")})),C.on("open",(function(){e.isConnected=!0,console.log("open")})),C.subscription.on("message",(function(t){e.addMessage(t),t.viewed||t.participantId===e.user.id||e.sendMarkMessageAsViewed([t.id])})),C.subscription.on("viewed",(function(t){e.setAsViewed(t)}))},onType:function(e){},onMessageSubmit:function(e){this.sendMessage(e)},sendMessage:function(){var e=Object(s.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.subscription.emit("message",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onClose:function(){this.logout()}})},A=(r("5c0b"),Object(f.a)(P,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app"},[[e.isConnected?r("p",{staticClass:"app__status"},[e._v(" Online "),r("span",{staticClass:"app__status-mark app__status-mark--online"},[e._v("●")])]):r("p",{staticClass:"app__status"},[e._v(" Offline "),r("span",{staticClass:"app__status-mark app__status-mark--offline"},[e._v("●")])])],r("div",{staticClass:"content"},[e.isAuth?e._e():r("div",{staticClass:"chat-container"},[r("auth")],1),e.isAuth?r("div",{staticClass:"chat-container"},[r("Chat",{attrs:{participants:e.participants,myself:e.user,messages:e.messages,"chat-title":e.chatTitle,placeholder:e.placeholder,colors:e.colors,"border-style":e.borderStyle,"close-button-icon-size":e.closeButtonIconSize,"submit-icon-size":e.submitIconSize,"async-mode":e.asyncMode,"scroll-bottom":e.scrollBottom,"display-header":!0,"send-images":!1,"profile-picture-config":e.profilePictureConfig,"timestamp-config":e.timestampConfig,"link-options":e.linkOptions,"hide-close-button":!1},on:{onMessageSubmit:e.onMessageSubmit,onType:e.onType,onClose:function(t){return e.onClose()}}})],1):e._e()])],2)}),[],!1,null,null,null)).exports;n.default.config.productionTip=!1,new n.default({render:function(e){return e(A)}}).$mount("#app")},"5c0b":function(e,t,r){"use strict";r("e332")},e332:function(e,t,r){}});